<!doctype>
<html>
<head>
<meta charset="UTF-8">
<title>CSS3 Gradient Generator Prototype</title>
<style>
canvas {
        border: 1px solid black;
		background: linear-gradient(0deg, #FFAC1C , #FF0000 );
}
div {
		text-align:center;
        width: 600px;
        margin-left: auto;
        margin-right: auto;
}
</style>
</head>
<body onload="rotateAxis(12)">
<div>
<h1>CSS3 Gradient Generator - WIP</h1>
    <h3>Click and drag to rotate the axis.</h3>
<canvas id ="myCanvas" width=600 height= 300>
</canvas><br><br><br>
<textarea id="css" cols=70 rows=8 readonly="readonly"></textarea>
</div>
</body>
<script>
var canvas = document.getElementById("myCanvas");
var context = canvas.getContext("2d");
var angle = 0;
var cx = 310,
    cy = 150;
var dragging = false;
updateGrad(0);

function rotateAxis(rAngle) {

    context.clearRect(0, 0, canvas.width, canvas.height);
    context.save();
    context.fillStyle = "#000000";
    context.translate(310, 150);
    context.rotate(rAngle * Math.PI / 180);
    context.translate(-310, -150);
    context.beginPath();
    context.arc(310, 150, 5, 0, 2 * Math.PI);
    context.fill();
    context.beginPath();
    context.moveTo(280, 10);
    context.lineTo(320, 200);
    context.stroke();
    context.restore();
}

var dx, dy;

canvas.onmousedown = function (event) {
    mousedown(event)
};
canvas.onmouseup = function (event) {
    mouseup(event)
};
canvas.onmousemove = function (event) {
    mousemove(event)
};


function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}

function limitAngle() {
	angle = Math.round(angle);
    if (angle < 0)
        angle = angle + 360;
    else if (angle >= 360)
        angle = angle - 360;
}

function mousedown(event) {
    dragging = true;
	calcAngle(event);
}

function mousemove(event) {
    if (dragging == true) {
        calcAngle(event);
        }
    }


function calcAngle(event) {
	var mousePos = getMousePos(canvas, event);
    x1 = mousePos.x;
    y1 = mousePos.y;
    if (x1 != cx && y1 != cy) {
        dx = (x1 - cx);
        dy = (y1 - cy);
        angle = Math.atan2(dy, dx) * 180 / Math.PI + 100 ;
        limitAngle();
        rotateAxis(angle);
		console.log(angle);
		angle = angle - 12;
		limitAngle();
        updateGrad();

    }
}

function mouseup(event) {
    dragging = false;
}

function updateGrad() {
	console.log("Grad Angle = "+angle);
    var p = document.getElementById('myCanvas');
    p.style.background = "linear-gradient(" + (angle) + "deg, #FFAC1C , #FF0000)";
	updateCSS(angle);
}

function updateCSS(tempAngle) {
	document.getElementById('css').value = "background: linear-gradient("+tempAngle+"deg , #FFAC1C , #FF0000);";
}
</script>
</html>